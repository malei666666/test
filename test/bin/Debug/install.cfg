#
#  Copyright 2020, China UnionPay Co., Ltd.  All right reserved.
#
#  THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF CHINA UNIONPAY CO.,
#  LTD.  THE CONTENTS OF THIS FILE MAY NOT BE DISCLOSED TO THIRD
#  PARTIES, COPIED OR DUPLICATED IN ANY FORM, IN WHOLE OR IN PART,
#  WITHOUT THE PRIOR WRITTEN PERMISSION OF CHINA UNIONPAY CO., LTD.
#
#
#  自动化安装编排文件
#  edited by malei 2020年8月17日 10:39
#
#
## 1 系统拓扑(分组描述说明，请以实际情况为准！！！！)
## 
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP1,,,<GAP41主机管理IP>,<GAP41主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP2,,,<GAP42主机管理IP>,<GAP42主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP3,,,<GAP43主机管理IP>,<GAP43主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP3,,,<GAP45主机管理IP>,<GAP45主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP3,,,<GAP47主机管理IP>,<GAP47主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP3,,,<GAP55主机管理IP>,<GAP55主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP4,,,<GAP44主机管理IP>,<GAP44主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP4,,,<GAP46主机管理IP>,<GAP46主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP4,,,<GAP48主机管理IP>,<GAP48主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP4,,,<GAP56主机管理IP>,<GAP56主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP5,,,<GAP51主机管理IP>,<GAP51主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP5,,,<GAP53主机管理IP>,<GAP53主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP6,,,<GAP52主机管理IP>,<GAP52主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP6,,,<GAP54主机管理IP>,<GAP54主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP7,,,<GAP57主机管理IP>,<GAP57主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP8,,,<GAP58主机管理IP>,<GAP58主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP9,,,<GAP61主机管理IP>,<GAP61主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP9,,,<GAP63主机管理IP>,<GAP63主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP10,,,<GAP62主机管理IP>,<GAP62主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP10,,,<GAP64主机管理IP>,<GAP64主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP11,,,<GAP11主机管理IP>,<GAP11主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP12,,,<GAP12主机管理IP>,<GAP12主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP13,,,<GAP41冷备主机管理IP>,<GAP41冷备主机服务IP>,':null)
## (<主机名>,mapgapas,MAPS,maps_upel,,DEFAULT,GAPGRP14,,,<GAP42冷备主机管理IP>,<GAP42冷备主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP1,,,<ONL1主机管理IP>,<ONL1主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP1,,,<ONL2主机管理IP>,<ONL2主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP1,,,<ONL3主机管理IP>,<ONL3主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP1,,,<ONL4主机管理IP>,<ONL4主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_A,,<ONL5主机管理IP>,<ONL5主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_A,,<ONL6主机管理IP>,<ONL6主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_A,,<ONL7主机管理IP>,<ONL7主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_A,,<ONL8主机管理IP>,<ONL8主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_B,,<ONL9主机管理IP>,<ONL9主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_B,,<ONL10主机管理IP>,<ONL10主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_B,,<ONL11主机管理IP>,<ONL11主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_B,,<ONL12主机管理IP>,<ONL12主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_C,,<ONL13主机管理IP>,<ONL13主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_C,,<ONL14主机管理IP>,<ONL14主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_C,,<ONL15主机管理IP>,<ONL15主机服务IP>,':null)
## (<主机名>,maponlas,MAPS,maps_upel,,DEFAULT,ONLGRP2,ONLGRP2_C,,<ONL16主机管理IP>,<ONL16主机服务IP>,':null)
## (<主机名>,mapregas,MAPS,maps_upel,,DEFAULT,REGGRP1,,,<REG1主机管理IP>,<REG1主机服务IP>,':null)
## (<主机名>,mapregas,MAPS,maps_upel,,DEFAULT,REGGRP1,,,<REG2主机管理IP>,<REG2主机服务IP>,':null)
## (<主机名>,mapregas,MAPS,maps_upel,,DEFAULT,REGGRP2,,,<REG3主机管理IP>,<REG3主机服务IP>,':null)
## (<主机名>,mapregas,MAPS,maps_upel,,DEFAULT,REGGRP2,,,<REG4主机管理IP>,<REG4主机服务IP>,':null)
## (<主机名>,mapumsas,MAPS,maps_upel,,DEFAULT,UMSGRP1,,,<UMS1主机管理IP>,<UMS1主机服务IP>,':null)
## (<主机名>,mapumsas,MAPS,maps_upel,,DEFAULT,UMSGRP1,,,<UMS2主机管理IP>,<UMS2主机服务IP>,':null)
## (<主机名>,mapumsas,MAPS,maps_upel,,DEFAULT,UMSGRP2,,,<UMS3主机管理IP>,<UMS3主机服务IP>,':null)
## (<主机名>,mapumsas,MAPS,maps_upel,,DEFAULT,UMSGRP2,,,<UMS4主机管理IP>,<UMS4主机服务IP>,':null)
## (<主机名>,mapbatas,MAPS,maps_upel,,DEFAULT,BATGRP1,,,<BAT1主机管理IP>,<BAT1主机服务IP>,':null)
## (<主机名>,mapbatas,MAPS,maps_upel,,DEFAULT,BATGRP1,,,<BAT2主机管理IP>,<BAT2主机服务IP>,':null)
## (<主机名>,mapbatas,MAPS,maps_upel,,DEFAULT,BATGRP2,,,<BAT3主机管理IP>,<BAT3主机服务IP>,':null)
## (<主机名>,mapbatas,MAPS,maps_upel,,DEFAULT,BATGRP2,,,<BAT4主机管理IP>,<BAT4主机服务IP>,':null)
## (<主机名>,maphcsas,MAPS,maps_upel,,DEFAULT,HCSGRP1,,,<HCS1主机管理IP>,<HCS1主机服务IP>,':null)
## (<主机名>,maphcsas,MAPS,maps_upel,,DEFAULT,HCSGRP2,,,<HCS2主机管理IP>,<HCS2主机服务IP>,':null)
##
## 



# #<AP_USER>应用主机用户名、<YYYYMMDD>（安装日期）、<VERSION>（版本名）、<MODULE>（模块名）
# #<HOSTNAME>（主机名）、<UNIT>（单元名）
# **************************************************************************************************
# **         [步骤名][<AP_USER>@系统名:组名:主机名(可选)]                                           **
# **         INSTALL [ 3600, Y]    = sh  ~/install/<VERSION>/<MODULE>/install/<脚本相对路径>       **
# **************************************************************************************************
# #回退步骤，仅当安装出现异常时执行
#            ROLLBACK [ 90, N]     = sh ~/install/<VERSION>/<MODULE>/install/<脚本相对路径>

#<VERSION>: MAPS-1.1
#<MODULE>:  maps_upel
#组名：   ONL1   BAT1 ...
#ROLLBACK 和 CLEARUP阶段的Y是没有用的，直接不询问执行

## 自动化安装
## 

## 2 系统变量
## 
## (<VERSION>,maps_upel,BAKDATE, <系统变量值>)
### 选配
## (<VERSION>,maps_upel,INSTALLDIR, <系统变量值>)
## (<VERSION>,maps_upel,BAKDIR, <系统变量值>)
## (<VERSION>,maps_upel,MGMDBADDR, <系统变量值>)
## (<VERSION>,maps_upel,MGMDBPORT, <系统变量值>)
## (<VERSION>,maps_upel,BATDBADDR, <系统变量值>)
## (<VERSION>,maps_upel,BATDBPORT, <系统变量值>)
## (<VERSION>,maps_upel,BATDATANODE, <系统变量值>)
## (<VERSION>,maps_upel,ONLDBADDR, <系统变量值>)
## (<VERSION>,maps_upel,ONLDBPORT, <系统变量值>)
## (<VERSION>,maps_upel,ONLDATANODE, <系统变量值>)

[确认步骤!!请确认数据库变更已经完成!!][<AP_USER>@MAPS:ONLGRP1:1]
PREP [7200, Y]       = echo "请确认数据库变更步骤已完成！！！"

[准备备份并导入参数][<AP_USER>@MAPS:BATGRP1:1]
PREP [7200, Y]       = echo "准备开始备份并导入参数"

############# 更新行业与内容参数

[备份并导入参数][<AP_USER>@MAPS:BATGRP1:1]
INSTALL [ 7200, N]   = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/genConfig.sh  <VERSION>  <MODULE>
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh data
ROLLBACK [3600, Y]   = echo "回退--备份并导入参数"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh data

[停止健康汇总端主][<AP_USER>@MAPS:HCSGRP1]
INSTALL [ 7200, N]   = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/genConfig.sh  <VERSION>  <MODULE>  SHMAPHCS
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh stop -s HCSS -s MTQ
ROLLBACK [3600, Y]   = echo "回退--停止健康汇总端主"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh stop -s HCSS -s MTQ
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh start -s HCSS -s MTQ





############# 加密服务组1

[安装加密服务组1应用][<AP_USER>@MAPS:UMSGRP1]
INSTALL [ 7200, N]   = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/genConfig.sh  <VERSION>  <MODULE>
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh stop -s UMS -s MTQ
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh shm -p CLOSE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh backup -s UMS -i \$INSTALLDIR -b \$BAKDIR -d \$BAKDATE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh update -s UMS -i \$INSTALLDIR
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh updcfg -s \$INSTALLDIR/mtq/etc/u1.xml -f \$HOME/install/<VERSION>/<MODULE>/install/patchscript_linux/etc/operation.ini
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh updcfg -s \$INSTALLDIR/mtq/etc/u2.xml -f \$HOME/install/<VERSION>/<MODULE>/install/patchscript_linux/etc/operation.ini
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh other "sh $HOME/onl/sbin/uu1.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh other "sh $HOME/onl/sbin/uu2.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh start -s UMS -s MTQ
ROLLBACK [3600, Y]   = echo "回退--安装加密服务组应用"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh stop -s UMS -s MTQ
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh shm -p CLOSE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recover -s UMS -b \$BAKDIR -i \$INSTALLDIR -d \$BAKDATE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recovercfg -f u1.xml -d \$INSTALLDIR/mtq/etc -b \$BAKDIR/ONL_\$BAKDATE/maps_upel/mtq/etc
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recovercfg -f u2.xml -d \$INSTALLDIR/mtq/etc -b \$BAKDIR/ONL_\$BAKDATE/maps_upel/mtq/etc
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh other "sh $HOME/onl/sbin/uu1.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh other "sh $HOME/onl/sbin/uu2.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh start -s UMS -s MTQ


############# 加密服务组2

[准备安装加密服务组2][<AP_USER>@MAPS:UMSGRP2:1]
PREP [7200, Y]       = echo "准备开始安装联机组2应用，继续安装前请确认加密机1安装后交易无异常！"
[安装加密服务组2应用][<AP_USER>@MAPS:UMSGRP2]
INSTALL [ 7200, N]   = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/genConfig.sh  <VERSION>  <MODULE>
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh stop -s UMS -s MTQ
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh shm -p CLOSE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh backup -s UMS -i \$INSTALLDIR -b \$BAKDIR -d \$BAKDATE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh update -s UMS -i \$INSTALLDIR
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh updcfg -s \$INSTALLDIR/mtq/etc/u1.xml -f \$HOME/install/<VERSION>/<MODULE>/install/patchscript_linux/etc/operation.ini
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh updcfg -s \$INSTALLDIR/mtq/etc/u2.xml -f \$HOME/install/<VERSION>/<MODULE>/install/patchscript_linux/etc/operation.ini
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh other "sh $HOME/onl/sbin/uu1.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh other "sh $HOME/onl/sbin/uu2.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh start -s UMS -s MTQ
ROLLBACK [3600, Y]   = echo "回退--安装加密服务组应用"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh stop -s UMS -s MTQ
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh shm -p CLOSE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recover -s UMS -b \$BAKDIR -i \$INSTALLDIR -d \$BAKDATE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recovercfg -f u1.xml -d \$INSTALLDIR/mtq/etc -b \$BAKDIR/ONL_\$BAKDATE/maps_upel/mtq/etc
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recovercfg -f u2.xml -d \$INSTALLDIR/mtq/etc -b \$BAKDIR/ONL_\$BAKDATE/maps_upel/mtq/etc
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh other "sh $HOME/onl/sbin/uu1.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh other "sh $HOME/onl/sbin/uu2.sh"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh start -s UMS -s MTQ



[安装健康汇总端主][<AP_USER>@MAPS:HCSGRP1]
INSTALL [ 7200, N]   = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/genConfig.sh  <VERSION>  <MODULE>  SHMAPHCS
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh backup -s HCS -i \$INSTALLDIR -b \$BAKDIR -d \$BAKDATE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh update -s HCS -i \$INSTALLDIR
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh start -s HCSS -s MTQ
ROLLBACK [3600, Y]   = echo "回退--安装健康汇总端主"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh stop -s HCSS -s MTQ
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recover -s HCS -b \$BAKDIR -i \$INSTALLDIR -d \$BAKDATE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh start -s HCSS -s MTQ



[安装健康汇总端备][<AP_USER>@MAPS:HCSGRP2]
INSTALL [ 7200, N]   = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/genConfig.sh  <VERSION>  <MODULE>  SHMAPHCS
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh backup -s HCS -i \$INSTALLDIR -b \$BAKDIR -d \$BAKDATE
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/install.sh update -s HCS -i \$INSTALLDIR
ROLLBACK [3600, Y]   = echo "回退--安装健康汇总端备"
                     = sh ~/install/<VERSION>/<MODULE>/install/patchscript_linux/uninstall.sh recover -s HCS -b \$BAKDIR -i \$INSTALLDIR -d \$BAKDATE
